## debian needs these tools 
DIR="$(pwd -P)"
apt install pax libarchive-tools
cd $DIR/images
mkdir iso
##unpack current iso for mods to initrd
bsdtar -C iso/ -xf debian-11-amd64-DVD-1.iso
chmod -R -w iso 
cd iso/install.amd
rm initrd.gz
## better compatability for install using netboot vs simple-cd initrd.gz
wget https://deb.debian.org/debian/dists/bullseye/main/installer-amd64/current/images/netboot/debian-installer/amd64/initrd.gz
cd ../
### redo md5sum 
md5sum `find ! -name "md5sum.txt" ! -path "./isolinux/*" -follow -type f` > md5sum.txt; cd ..
chmod -R -w iso
## use orginal DVD boot info to make new iso UEFI an legacy boot
dd if=debian-11-amd64-DVD-1.iso bs=1 count=432 of=isohdpfx.bin
## Rebuild the iso with old iso info for booting 
xorriso -as mkisofs -o zimaboard-11.7-amd64.iso \
-isohybrid-mbr isohdpfx.bin \
-c isolinux/boot.cat -b isolinux/isolinux.bin \
-no-emul-boot -boot-load-size 4 -boot-info-table ./iso
## cleanup 
rm ./iso -r
rm isohdpfx.bin
